## 13.1 文件概念
类型
### 13.1.1 文件属性
1.文件属性
- 名称
- 标识符
- 类型
- 位置
- 大小
- 保护
- 时间戳和用户标识
2.目录
### 13.1.2 文件操作
1.操作
- 创建
- 打开
- 写（写指针）
- 读（读指针）
- 重定位
- 删除
- 截断
- 打开
- 关闭
2.打开文件的关联信息
- 打开文件表
- 文件指针
- 文件打开次数
- 文件磁盘位置
- 访问权限
3.文件锁
- 共享锁：共享锁类似于读锁，允许多个进程同时持有锁
- 独占锁：独占锁类似于写锁，一次只能被一个进程持有
- 强制：根据已有锁和请求的锁决定是否允许访问，系统会强制执行访问控制
- 建议：系统不会强制限制访问，进程需要主动检查锁状态并自觉遵守
### 13.1.3 文件类型
[[lesson13-filesystem-interface.pdf#page=11&selection=11,0,15,15|lesson13-filesystem-interface, p.11]]
## 13.2 访问方法
### 13.2.1 顺序访问
1.从头开始，依次读取或写入文件内容
2.操作：
①读取下一个：读取当前位置之后的下一个记录，读取后文件指针会自动前移
②写入下一个：在当前位置写入记录，并将写指针移动到新写入内容之后
③重置：将文件指针重置到开头，从头开始重新读或写
不能在写入后直接读
### 13.2.2 直接访问/相对访问
1.允许进程直接跳转到文件中的任意位置（块）进行读/写，而不需要依次遍历前面的内容
2.操作
n：相对块号，是文件内部的逻辑编号，不直接等同于磁盘物理位置
①读取n：从编号为 _n_ 的块中读取数据
②写入n：向编号为 _n_ 的块写入数据
③定位到n：将文件指针移动到编号为 _n_ 的块，之后可以执行以下操作
- 从 _n_ 开始顺序读取
- 从 _n_ 开始顺序写入
- 覆盖块 _n_ 中的内容
### 13.2.3 其他访问方法
基于索引的访问
## 13.3 目录结构
对目录执行的操作：
- 搜索文件
- 创建文件
- 删除文件
- 列出目录内容
- 重命名文件
- 遍历文件系统
### 13.3.1 单级目录
所有文件都包含在同一目录中
- 所有文件必须具有唯一的名称
- 无法对文件进行分组管理
### 13.3.2 两级目录
每个用户拥有一个独立的用户文件目录，所有用户的目录记录在一个主文件目录中
- 访问文件需要完整路径
- 不同用户可以有相同名字的文件
- 查找时只需在对应用户的子目录中搜索
- 不支持进一步的子目录或层级结构
### 13.3.3 树形目录
- 根目录是唯一入口
- 支持嵌套目录
- 每个用户或程序可以根据需要自定义目录结构
### 13.3.4 无环图目录
- 禁止形成环
- 允许共享子目录和文件
- 同一个文件/目录可能被多个路径引用，形成别名
悬空指针问题：某些引用已经失效，指向的资源已被释放或部分释放
解决：
- 反向指针：文件对象记录有哪些目录项指向它，删除目录时，自动清除所有相关指针
- 菊花链式组织：将引用者串成链条
- 引用计数：给每个文件维护一个被引用次数计数器，计数为0时才真正释放文件
新的目录项类型：
- 链接：是一个指向现有文件的别名
- 解析链接：访问时操作系统会自动跟随链接找到真实文件
### 13.3.5 通用图目录
如何保证目录结构中没有回路：
- 只允许链接到文件，而不允许链接到子目录
- 使用垃圾回收机制
- 每次添加新链接时，运行一次回路检测算法判断是否安全
#### 当前目录
可以将某个目录指定为当前工作目录
## 13.4 保护
### 13.4.1 访问类型
- **Read（读取）**：查看文件内容
- **Write（写入）**：修改或重写文件内容
- **Execute（执行）**：运行可执行文件（如 `.exe`、shell脚本等）
- **Append（追加）**：在文件末尾添加内容，不修改原有部分
- **Delete（删除）**：删除文件
- **List（列出）**：查看目录下的文件列表（常用于目录的权限）
#### UNIX
1.访问模式
- r：读
- w：写
- x：执行
2.Unix/Linux的3类用户：
- 所有者访问权限：RWX=111（可读可写可执行）=7
- 用户组访问权限：RWX=110（可读可写）=6
- 其他人访问权限：RWX=001（只可执行）=1
