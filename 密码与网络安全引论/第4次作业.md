
# 第1部分
### 一、测试要求
测试杂凑函数SHA-3的雪崩效应
### 二、测试过程
#### （一）使用SHA3-256进行测试，试验次数为100次
1.`flip_one_bit`：制造微小扰动
``` python
def flip_one_bit(data:bytes):#随机翻转输入的1位bit
    data_copy=bytearray(data)
    byte_pos=random.randint(0,len(data_copy)-1)#随机选择byte
    bit_pos=random.randint(0,7)#随机选择bit
    data_copy[byte_pos]=data_copy[byte_pos]^(1<<bit_pos)#翻转
    return bytes(data_copy)
```

2.`count_different_bits`：计算2个哈希输出之间不同bit的个数
``` python
def count_different_bits(b1:bytes,b2:bytes):#统计2个哈希值不同bit位数
    total_diff_bits=0
    for byte1,byte2 in zip(b1,b2):
        xor_result=byte1^byte2#异或
        binary_str=bin(xor_result)#转为二进制
        bit_diff_count=binary_str.count('1')#统计
        total_diff_bits=total_diff_bits+bit_diff_count
    return total_diff_bits
```

3.`sha3_hash`：哈希函数
``` python
def sha3_hash(data:bytes):#对输入进行SHA-3处理
    return hashlib.sha3_256(data).digest()
```
  
4.`test_avalanche_sha3`：测试SHA-3的雪崩效应
``` python
def test_avalanche_sha3(bits=256, trials=100):#测试雪崩效应
    total_bits=bits
    bit_diffs=[]
    for _ in range(trials):
        m=os.urandom(64)#生成数据
        m_prime=flip_one_bit(m)#翻转
        hash_m=sha3_hash(m)#对原始数据进行SHA-3处理
        hash_m_prime=sha3_hash(m_prime)#对扰动后的数据进行SHA-3处理
        diff=count_different_bits(hash_m,hash_m_prime)#比较差异
        bit_diffs.append(diff)
    avg_diff=sum(bit_diffs)/trials
    percentage=avg_diff/total_bits*100
    print(f"average difference={avg_diff}bit")#差异数的平均值
    print(f"average percentage={percentage}%")#变化率的平均值
    print("difference:")#每次的差异数
    print(bit_diffs)
```
#### （二）使用SHA3-224进行测试，试验次数为100次
其它函数相同，只修改`sha3_hash`
``` python
def sha3_hash(data:bytes):#对输入进行SHA-3处理
    return hashlib.sha3_224(data).digest()
```
#### （三）使用SHA3-384进行测试，试验次数为100次
其它函数相同，只修改`sha3_hash`
``` python
def sha3_hash(data:bytes):#对输入进行SHA-3处理
    return hashlib.sha3_384(data).digest()
```
#### （四）使用SHA3-512进行测试，试验次数为100次
其它函数相同，只修改`sha3_hash`
``` python
def sha3_hash(data:bytes):#对输入进行SHA-3处理
    return hashlib.sha3_512(data).digest()
```
### 三、测试结果
#### SHA3-256
average difference=128.53bit
average percentage=50.20703125%
difference:
[144, 138, 127, 134, 119, 122, 121, 147, 114, 142, 141, 135, 134, 122, 127, 128, 137, 130, 139, 121, 114, 126, 137, 131, 144, 131, 126, 124, 124, 128, 126, 113, 135, 125, 135, 127, 111, 142, 133, 135, 134, 120, 132, 127, 126, 127, 129, 146, 129, 135, 123, 132, 123, 128, 112, 125, 122, 136, 126, 127, 136, 121, 126, 130, 120, 143, 130, 129, 134, 126, 132, 129, 119, 128, 117, 124, 116, 137, 124, 123, 125, 129, 132, 124, 126, 129, 135, 125, 123, 128, 124, 134, 121, 131, 153, 132, 115, 119, 133, 123]
#### SHA3-224
average difference=111.72bit
average percentage=49.875%
difference:
[119, 110, 98, 108, 127, 112, 113, 121, 97, 108, 106, 116, 118, 110, 116, 104, 95, 109, 121, 122, 120, 117, 111, 109, 101, 123, 129, 105, 118, 103, 123, 113, 115, 118, 106, 115, 103, 103, 112, 115, 106, 114, 120, 104, 130, 108, 114, 104, 110, 110, 111, 98, 103, 114, 102, 118, 97, 109, 120, 104, 130, 117, 115, 122, 110, 113, 110, 123, 105, 103, 118, 112, 111, 110, 101, 117, 115, 114, 95, 106, 104, 110, 122, 96, 107, 117, 92, 117, 121, 115, 120, 107, 116, 122, 118, 110, 106, 106, 125, 109]
#### SHA3-384
average difference=190.5bit
average percentage=49.609375%
difference:
[203, 171, 183, 189, 209, 194, 193, 200, 196, 187, 185, 177, 195, 187, 187, 197, 190, 206, 195, 185, 199, 191, 183, 190, 184, 201, 179, 167, 207, 196, 188, 176, 202, 185, 184, 177, 202, 194, 200, 186, 184, 172, 178, 212, 195, 187, 173, 179, 176, 199, 186, 185, 178, 178, 190, 189, 186, 206, 200, 190, 179, 190, 175, 207, 193, 204, 192, 183, 187, 195, 195, 181, 206, 190, 201, 204, 169, 190, 185, 183, 202, 189, 196, 210, 202, 186, 194, 183, 176, 180, 197, 196, 212, 188, 195, 194, 194, 182, 202, 200]
#### SHA3-512
average difference=254.93bit
average percentage=49.791015625%
difference:
[251, 238, 262, 254, 267, 263, 265, 251, 255, 240, 255, 240, 235, 270, 248, 244, 249, 250, 271, 267, 270, 255, 270, 271, 253, 240, 257, 264, 234, 244, 252, 250, 248, 276, 262, 265, 249, 240, 243, 245, 264, 249, 256, 238, 251, 257, 270, 259, 247, 240, 258, 262, 268, 266, 259, 267, 271, 254, 238, 255, 255, 239, 224, 237, 259, 258, 266, 258, 260, 260, 252, 269, 250, 263, 260, 271, 255, 270, 274, 253, 246, 238, 265, 256, 268, 261, 251, 239, 252, 263, 245, 262, 251, 248, 263, 269, 231, 232, 246, 282]
### 四、结果分析
#### SHA3-256
雪崩效应良好，平均bit变化值=128.53，接近理想值256/2=128
![[SHA3-256 2.png]]
#### SHA3-224
雪崩效应良好，平均bit变化值=111.72，接近理想值224/2=112
![[SHA3-224.png]]
#### SHA3-384
雪崩效应良好，平均bit变化值=190.5，接近理想值384/2=192
![[SHA3-384.png]]
#### SHA3-512
雪崩效应良好，平均bit变化值=254.93，接近理想值512/2=256
![[SHA3-512.png]]

# 第2部分

### 一、测试要求
测试杂凑函数SM3的雪崩效应
### 二、测试过程
进行100组测试
1.`flip_one_bit`：制造微小扰动
```python
def flip_one_bit(data:bytes):
    data_copy=bytearray(data)
    byte_pos=random.randint(0,len(data_copy)-1)#随机选择byte
    bit_pos=random.randint(0,7)#随机选择bit
    data_copy[byte_pos]=data_copy[byte_pos]^(1<<bit_pos)#翻转
    return bytes(data_copy)
```
  
2.`count_different_bits`：计算2个哈希输出之间不同bit的个数
```python
def count_different_bits(b1:bytes,b2:bytes):
    total_diff_bits=0
    for byte1,byte2 in zip(b1,b2):
        xor_result=byte1^byte2#异或
        binary_str=bin(xor_result)#转为二进制
        bit_diff_count=binary_str.count('1')#统计
        total_diff_bits=total_diff_bits+bit_diff_count
    return total_diff_bits
```
  
3.`sm3_hash`：哈希函数
```python
def sm3_hash(data:bytes):
    hex_digest=sm3.sm3_hash(func.bytes_to_list(data))
    return bytes.fromhex(hex_digest)#将十六进制转为二进制
```

4.`test_avalanche_sm3`：测试SM3的雪崩效应
```python
def test_avalanche_sm3(trials=100):
    bits=256
    bit_diffs=[]
    for _ in range(trials):
        m=os.urandom(64)#生成数据         
        m_prime=flip_one_bit(m)#翻转 
        hash_m=sm3_hash(m)#对原始数据进行SHA-3处理
        hash_m_prime=sm3_hash(m_prime)#对扰动后的数据进行SHA-3处理
        diff=count_different_bits(hash_m, hash_m_prime)#比较差异
        bit_diffs.append(diff)
    avg_diff=sum(bit_diffs)/trials
    percentage=avg_diff/bits*100
    print(f"average difference={avg_diff} bit")
    print(f"average percentage={percentage}%")
    print("difference:")
    print(bit_diffs)
```

### 三、测试结果
average difference=127.94 bit
average percentage=49.9765625%
difference:
[122, 122, 120, 117, 133, 123, 122, 123, 133, 142, 125, 133, 133, 139, 127, 123, 122, 113, 134, 129, 122, 119, 124, 135, 132, 116, 128, 135, 122, 135, 137, 114, 123, 123, 131, 112, 127, 131, 138, 124, 143, 138, 137, 138, 122, 115, 120, 132, 136, 128, 133, 143, 133, 129, 128, 138, 126, 127, 135, 146, 108, 120, 129, 128, 119, 121, 136, 118, 125, 126, 118, 131, 113, 134, 134, 126, 142, 134, 138, 120, 130, 132, 112, 120, 132, 132, 136, 128, 128, 126, 149, 110, 126, 121, 137, 121, 139, 131, 124, 130]
### 四、结果分析
雪崩效应良好，平均bit变化值=127.94，接近理想值256/2=128
![[SM3.png]]