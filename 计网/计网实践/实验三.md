
| 实验课程：计算机网络实践        | 年级：2024级       | 实验成绩：           |
| ------------------- | -------------- | --------------- |
| 实验名称：Protocol Layer | 姓名：史紫昱         |                 |
| 实验编号：实验一            | 学号：10245101423 | 实验日期：2025.11.19 |
| 指导教师：章玥             | 组号：22          | 实验时间：2025.11.19 |
# （一）实验目的
1. 学会通过Wireshark分析ip协议
2. 了解wireshark、curl、wget、traceroute、tracert等常用软件的使用，掌握网络抓包的方法，能在所用电脑上进行抓包; 
3. 了解IP数据包格式，能应用该软件分析数据包格式，查看抓到的包的内容，并分析对应的IP数据包格式; 
4. 了解IP各部分的含义
# （二）实验内容与实验步骤
## 一、捕获IP Packets
1. 启动Wireshark，在菜单栏的捕获->选项中进行设置，选择已连接的以太网，设置捕获过滤器为“tcp port 80”，将混杂模式设为关闭,勾选 enable network name resolution.然后开始捕获。
![[Pasted image 20251210080613.png]]
![[Pasted image 20251210080626.png]]
2. 打开windows的命令行，在里面输入wget www.sina.com
![[Pasted image 20251210080710.png]]
3. 停止捕获。
## 二、捕获Trace
1. 启动Wireshark，在菜单栏的捕获->选项中进行设置，选择已连接的以太网，设置捕获过滤器为“icmp”，将混杂模式设为关闭,勾选 enable network name resolution.然后开始捕获。
![[Pasted image 20251210080914.png]]
2. 执行 tracert www.baidu.com 。
![[Pasted image 20251210083330.png]]
3. 当命令执行结束，则Wireshake中停止捕获，查看Wireshark界面中的封包列表中如果出现数据包则说明抓包成功； 
# （三）实验环境
1.实验所使用的器件：笔记本
2.仪器设备名称：LAPTOP-9FV2DSHF
3.规格
①处理器：13th Gen Intel(R) Core(TM) i5-13500H (2.60 GHz)
②机带RAM：32.0 GB (31.7 GB 可用)
③系统类型：64位操作系统, 基于x64的处理器
# （四）实验过程与分析
## 一、捕获IP Packets
由于未连接以太网，无法捕捉到任何包，因此使用WLAN进行实验
![[Pasted image 20251210082647.png]]
![[Pasted image 20251210082921.png]]
![[Pasted image 20251210083123.png]]
![[Pasted image 20251210171226.png]]
## 二、捕获Trace
由于未连接以太网，无法捕捉到任何包，因此使用WLAN进行实验
![[Pasted image 20251210082948.png]]
输入tracert www.ecnu.edu.cn
![[Pasted image 20251210090028.png]]
![[Pasted image 20251210170638.png]]
# （五）实验结果总结
## 一、选择你通过Wireshark捕获到任何一个报文，分析其IP报文头部：
#### 1、尽量不要打开教科书，请根据抓到的报文，描绘IP报文头的图片，并指出报文中每个fields的含义所在。
以tracert www.ecnu.edu.cn 捕获的第1个包为例
![[屏幕截图 2025-12-10 165155.png]]
![[Pasted image 20251210165945.png]]
- 第1行
	- Version：表示IP协议的版本
	- IHL：表示IP头部的长度，以4Bytes为单位
	- Differentiated services：包含服务优先级DSCP和拥塞通知ECN
	- Total length：整个IP数据报的长度
- 第2行
	- Identification：用于唯一标识一个IP数据报
	- DF：禁止分片
	- MF：是否还有后续分片
	- Fragment offset：表示该分片在原始报文中的位置
- 第3行
	- Time to live：表示报文在网络中允许经过的最大路由器跳数
	- Protocol：表示IP负载封装的上层协议类型
	- Header checksum：用于对IP头步进行差错检验
- 第4行：Source Address，表示发送该IP数据报的主机地址
- 第5行：Destination Address，表示接收该IP数据报的目标主机地址
- 第7行：Options，用于扩展IP功能
## 二、通过观察Wireshark捕获的报文，来回答下面的问题：
#### 1.你的计算机和远程服务器的IP地址是什么？
计算机IP地址：172.25.13.115
www.sina.com 的远程服务器IP地址：121.194.5.14
www.ecnu.edu.cn 的远程服务器IP地址：202.120.92.21
#### 2.“总长度”字段是否包括IP报头加上IP有效负载，或者仅包括IP有效负载？
Total length包含IP头长度和IP有效负载长度
#### 3.对于不同的数据包，“标识”字段的值如何变化，还是保持不变？ 例如，对于TCP连接中的所有数据包，它一直保持相同的值，还是对于每个数据包都不同？ 双向通信的报文是否相同？ 如果值发生变化，您能看到任何规律吗？
对于不同的数据包，Identification会变化
①比如，在捕获IP packets时，frame1的Identification=0x8afd，而frame2的Identification=0x0000
![[Pasted image 20251210171347.png]]
![[Pasted image 20251210171429.png]]
②对于TCP连接中的所有数据包：
以捕获IP packets的$tcp.stream==0$的数据包为例
![[屏幕截图 2025-12-10 172009.png]]
![[Pasted image 20251210172213.png]]
frame8的Identification=0x8b00，frame9的Identification=0x8b15
![[Pasted image 20251210172244.png]]
![[Pasted image 20251210172338.png]]
③双向通信的报文：
以frame10和frame11为例
frame10的Identification=0xcca2，frame11的Identification=0x8b30
![[Pasted image 20251210172521.png]]
![[Pasted image 20251210172554.png]]
④规律
对于从笔记本发送到服务器的数据包：是一组递增序列

| id  | Identification |
| --- | -------------- |
| 1   | 0x8afd(35581)  |
| 3   | 0x8afe(35582)  |
| 4   | 0x8aff(35583)  |
| 8   | 0x8b00(35584)  |
| 9   | 0x8b15(35605)  |
| 11  | 0x8b30(35632)  |

对于从服务器发送到笔记本的数据包：也是一组递增序列

| id  | Identification |
| --- | -------------- |
| 2   | 0x0000(0)      |
| 5   | 0xcc9f(52383)  |
| 6   | 0xcca0(52384)  |
| 7   | 0xcca1(52385)  |
| 10  | 0xcca2(52386)  |

## 三、通过观察Wireshark捕获的报文，来回答下面的问题： 
#### 4.从您的计算机发送的数据包的TTL字段的初始值是多少？他们是maximum possible value吗？
TTL初始值为128，不是最大可能值，最大可能值是255。
![[Pasted image 20251210192335.png]]
#### 5.查看数据包时如何判断它是否被分段？
如果Fragment offset≠0，说明该数据包是后续分段，即一定发生了分段；如果MF=1，说明后面还有分段，即一定发生了分段；只有当这两项都为0时，才能判定该数据包没有被分段。
#### 6.IP数据报报头的长度是多少，它是如何被编码进报头长度域的？
长度为20Bytes，IHL=5，以4Bytes为单位进行编码，表示IP头的长度为4IHLBytes，即4×5=20Bytes
![[Pasted image 20251210192410.png]]
## 四、观察traceroute的结果图，来进行结果分析：
#### 使用traceroute的结果，绘制网络路径图。 图中，显示您的计算机（放在最左侧）和远程服务器（放在最右侧），均显示IP地址，以及它们之间的路径上的路由器，这些路由器以从本机开始的跳数作为距离编号。 您可以在捕获的跟踪数据包中找到计算机和远程服务器的IP地址。
traceroute的结果：
![[屏幕截图 2025-12-10 090438.png]]
![[Pasted image 20251210194022.png]]

## 五、观察IP报文的校验和：
#### IP报头的校验和可以用来验证一个数据包是否正确。选择一个从远程服务器发送到本计算机的包，计算它的checksum。在计算过程中，请添加注释，表明每个word对应的字段。
以捕获Trace的frame32为例
![[Pasted image 20251210195800.png]]
IPv4的头部为：45 00 00 5C 1A 10 40 00 FB 01 85 76 CA 78 5C 15 AC 19 0D 73
![[Pasted image 20251211145528.png]]
- 45：Version=4
- 00：Differentiated Services Field=0x00
- 00 5c：Total Length=92
- 1a 10：Identification=0x1a10
- 40 00：Fragment Offset
- fb：Time to Live=251
- 01：Protocol=ICMP（1）
- 85 76：Header Checksum=0x8576
- ca 78 5c 15：Source Address=202.120.92.21
- ac 19 0d 73：Destination Address=172.25.13.115
4500+005C+1A10+4000+FB01+0000+CA78+5C15+AC19+0D73并将高位加回=0x7A89，取反=0x8576
其Header Checksum=0x8576
![[Pasted image 20251211145935.png]]

# （六）附录
无
