
| 实验课程：计算机网络实践        | 年级：2024级       | 实验成绩：           |
| ------------------- | -------------- | --------------- |
| 实验名称：Protocol Layer | 姓名：史紫昱         |                 |
| 实验编号：实验一            | 学号：10245101423 | 实验日期：2025.11.19 |
| 指导教师：章玥             | 组号：22          | 实验时间：2025.11.19 |
# （一）实验目的

1.学习协议和分层如何用数据包表示
2.熟悉wireshark软件、curl、wget等常用软件的使用，掌握网络抓包的方法，能在所用电脑上进行抓包
3.了解IP数据包格式，能应用该软件分析数据包格式，查看抓到的包的内容，并分析对应的IP数据包格式
4.抓包分析数据包，估算协议的开销
5.通过数据包抓取实验，将理论与实践相结合，深入理解协议层的字段与结构特征
# （二）实验内容与实验步骤
## 一、实验内容
使用Wireshark和wget抓取HTTP请求的数据包
## 二、原理分析
抓取HTTP请求的数据包的协议栈如图所示：
![[Pasted image 20251119090827.png]]
请求的步骤如下：
1.客户端通过TCP三次握手与服务器建立连接
2.TCP建立连接成功后，向服务器发送HTTP请求
3.服务器接收客户端的HTTP请求后，将返回应答，并向客户端发送数据
4.客户端通过TCP四次断开，与服务器断开TCP连接
## 三、具体实验步骤
#### 1.启动Wireshark点击->捕获->选项->输入tab->选择本地网卡，过滤条件（所选择接口的捕获过滤 器）为 "tcp port 80"，在选项tab中勾选解析网络名称，点击开始按钮。
![[Pasted image 20251119081714.png]]
#### 2.关闭不必要的浏览器标签和窗口,避免跟踪非目的流量。
#### 3.在命令行中选取一个URL，用wget获取。
![[Pasted image 20251119082954.png]]
#### 4.打开Wireshark，停止捕获
#### 5.查看Wireshark界面中的封包列表中如果出现数据包则说明抓包成功
![[Pasted image 20251119083139.png]]

# （三）实验环境
1.实验所使用的器件：笔记本
2.仪器设备名称：LAPTOP-9FV2DSHF
3.规格
①处理器：13th Gen Intel(R) Core(TM) i5-13500H (2.60 GHz)
②机带RAM：32.0 GB (31.7 GB 可用)
③系统类型：64位操作系统, 基于x64的处理器
# （四）实验过程与分析
## 分析packet
![[Pasted image 20251119085606.png]]
以第1个包为例
### 第一个Wireshark块是Frame。这不是一个协议，它是描述包的总体信息的记录，包括它被捕获的时间和它有多少位长
![[Pasted image 20251119091016.png]]
### 第二个块是以太网
![[Pasted image 20251119091056.png]]
### 然后是IP、TCP和HTTP.顺序是从协议栈的底部向上的,因为当数据包沿着堆栈向下传递时，较低层协议的报头信息被添加到来自较高层协议的信息的前面。也就是说，较低层协议首先出现在线路上的数据包中
![[Pasted image 20251119091142.png]]
# （五）实验结果总结
## 一、在抓取HTTP请求的GET方法时，分析其数据包，思考下列问题
### 1.根据抓取的HTTP请求的GET方法的抓取结果，分析协议包的内容
![[Pasted image 20251119092009.png]]
#### ①Frame
![[Pasted image 20251202141151.png]]
倒数第4行的`protocols in frame`字段显示：

|层级|协议|
|---|---|
|数据链路层|Ethernet|
|网络层|IP|
|传输层|TCP|
|应用层|HTTP|
所以这是一个HTTP GET请求协议包
#### ②Ethrnet Ⅱ
![[Pasted image 20251202141220.png]]
目的MAC地址：`b8:d4:f7:21:78:02`
源MAC地址：`8c:e9:ee:9f:d4:22`
#### ③Internet Protocol Version 4
![[Pasted image 20251119092123.png]]
（1）Src和Dst部分给出了源IP和目的IP
（2）IP数据报的长度=168bytes
（3）上层协议类型是TCP
#### ④Transmission Control Protocol传输控制协议
![[Pasted image 20251202141334.png]]
![[Pasted image 20251202141404.png]]
（1）源端口号=51780，目的端口=80
（2）TCP报文段携带了128bytesHTTP GET请求内容的应用层数据
（3）next seq=129，ack=1
（4）FLAG：只有ack和psh设为1，表示要立即把数据传输给应用层，并确认已收到对方的数据
（5）滑动窗口：原始窗口=255bytes，通过扩大因子256扩大为65280bytes
#### ⑤Hypertext Transfer Protocol超文本传输协议
![[屏幕截图 2025-11-19 092905.png]]
（1）请求行`GET / HTTP/1.1\r\n`：表示客户端使用HTTP/1.1协议请求服务器返回网站首页对应的资源
（2）Host表示要访问的具体网站域名
（3）User-Agent表示是HTTP请求由wget发起
（4）Accept表示对接收的数据类型不作任何格式限制
（5）Accept-Encoding表示不希望服务器对内容进行压缩
（6）Connection表示保持TCP连接
（7）最后一行是wireshark解析出的完整url
### 2.画一个关于使用GET方法的HTTP请求的图，为了显示协议层的嵌套结构，请分别标出Ethernet， IP和TCP协议的头部的位置、大小以及其负载的范围
![[Pasted image 20251202160324.png]]
### 3.根据数据包的抓取结果，分析协议开销
Ethernet Header=14B
IP Header=20B
TCP Header=20B
协议开销=14+20+20=54B
### 4.估计协议的开销或者是协议开销占用下载字节的百分比。对于下载的主要部分中的每一个包，我们需要分析 Ethernet，IP和TCP的开销，和有用的HTTP数据的开销，你认为这种开销是必要的吗？ （假设HTTP数据（头部和消息）是有用的，而TCP，IP和Ethernet头部认为是开销。）
![[Pasted image 20251202161238.png]]
No.4是客户端请求，所以属于下载过程的只有No.6-11

|                 | No.6 | No.7 | No.8 | No.9 | No.10 | No.11 |
| --------------- | ---- | ---- | ---- | ---- | ----- | ----- |
| Frame           | 566B | 843B | 566B | 566B | 387B  | 387B  |
| Ethernet Header | 14B  | 14B  | 14B  | 14B  | 14B   | 14B   |
| IP Header       | 20B  | 20B  | 20B  | 20B  | 20B   | 20B   |
| TCP Header      | 20B  | 20B  | 20B  | 20B  | 20B   | 20B   |
| HTTP有效数据        | 512B | 789B | 512B | 512B | 333B  | 333B  |
Frame总和=566+843+566+566+387+387=3315B
总协议开销=6×54=324B
$开销占比=\frac{324}{3315}=9.77\%$
Ethernet Header用于链路寻址，IP Header用于网络路由，TCP Header用于可靠传输控制，从而保障HTTP数据正确，因此这种开销是必要的。
## 二、观察下载的以太网和IP头包回答下面问题
### 1.以太网头部中哪一部分是解复用（解复用： 找到正确的上一层协议来处理到达的包的行为叫做 解复用）键并且告知它的下一个高层指的是IP，在这一包内哪一个值可以表示IP？
Ethernet II的`Type:IPv4(0x0800)`是解复用键，指向的下一个高层协议是IPv4，0x0800表示IP
### 2.IP头部中哪一部分是解复用键并且告知它的下一个高层指的是TCP，在这一包内哪一个值可以表示TCP？ 
Internet Protocol的`Protocol:TCP(6)`是解复用键，6对应的协议是TCP
## 三、在完成本实验后探索协议和分层，思考下列问题
### 1.查看不包含高层数据的短TCP数据包，查看它发往哪？不携带高层数据的数据包有用吗？
![[屏幕截图 2025-11-19 085845.png]]
以第5个包为例。Len=0表示这个包是不包含高层数据的短TCP数据包，是从百度的服务器(182.61.200.110)发往我的笔记本电脑(172.25.13.115)。这个数据包的作用是：百度服务器确认已经收到了笔记本发送来的数据，希望收到第129号数据。
### 2.在经典的分层模型中，低层字段包装到高层数据包外面，成为一条新消息。但这并非总是如此,Web响应（一个包含HTTP标头和HTTP有效负载的HTTP消息）可能被转换为多个较低层的消息（即多个TCP数据包）。假设你为Web响应的第一个和最后一个TCP数据包绘制了数据包结构，那么该结构与经典分层模型有什么不同？
在经典分层模型，被封装的是完整的HTTP响应
![[Pasted image 20251202184408.png]]
而Web响应的第一个和最后一个TCP数据包的结构如下：
![[Pasted image 20251202184554.png]]
区别在于：在经典的分层模型中，一条完整的 HTTP 响应消息被整体封装进一个TCP段中，再由IP和Ethernet层继续封装，形成一条完整的数据包；而Web相应的第一个数据包封装的是HTTP响应Header和一部分数据，最后一个数据包封装的是最后一部分HTTP数据，也就是HTTP消息被分成多个数据包进行封装和传输。
### 3.在上述经典分层模型中，低层字段包装到高层数据包外面，如果较低层添加加密，此模型将如何更改？
如果较低层添加加密，那么高层数据会先被加密，再被封装，抓包工具无法解析被加密的具体内容，只能识别加密层以下的Header。
### 4.在上述经典分层模型中，低层字段包装到高层数据包外面,如果较低的层添加压缩，此模型将如何更改？
如果较低层添加压缩，那么高层数据将从以明文形式被封装变为以压缩后的形式作为低层协议的负载进行传输。
# （六）附录
无