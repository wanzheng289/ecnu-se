
| 实验课程：计算机网络实践 | 年级：2024级       | 实验成绩：           |
| ------------ | -------------- | --------------- |
| 实验名称：TCP     | 姓名：史紫昱         |                 |
| 实验编号：实验六     | 学号：10245101423 | 实验日期：2025.12.31 |
| 指导教师：章玥      | 组号：22          | 实验时间：2025.12.31 |
# （一）实验目的
1.熟悉使用wireshark软件进行抓取TCP数据包 ；
2.分析抓取到的TCP数据包，掌握TCP数据包结构；
3.掌握TCP数据包各字段的含义；
4.掌握TCP连接建立和释放的步骤； 
5.掌握TCP数据传输过程；
# （二）实验内容与实验步骤
1.以http://old.ecnu.edu.cn/site/xiaoli/2016.jpg为例，使用wget确认URL有效，或者使用你感兴趣的URL；
2.启动Wireshark，在菜单栏的捕获->选项中进行设置，选择已连接的以太网，设置捕获过滤器为tcp and host xx.xx.xx，xx.xx.xx是要从中获取内容的服务器名称，如上述例子中的old.ecnu.edu.cn；
3.捕获开始后，重复第一步，重新发送请求；
4.命令完成后，停止捕获。
# （三）实验环境
1. 实验所使用的器件：笔记本
2. 仪器设备名称：LAPTOP-9FV2DSHF
3. 规格
①处理器：13th Gen Intel(R) Core(TM) i5-13500H (2.60 GHz)
②机带RAM：32.0 GB (31.7 GB 可用)
③系统类型：64位操作系统, 基于x64的处理器
# （四）实验过程与分析
使用url：
`https://hf-mirror.com/Qwen/Qwen2.5-7B-Instruct/resolve/main/model-00001-of-00004.safetensors`
使用wget测试：
![[Pasted image 20251224090543.png]]
启动wireshark
![[Pasted image 20251224090712.png]]
重新发送请求
![[屏幕截图 2025-12-24 090935.png]]
因此使用`tcp and (host hf-mirror.com or host cas-bridge.xethub.hf.co)`
![[Pasted image 20251224091311.png]]
![[Pasted image 20251224104438.png]]
捕获完成：
![[Pasted image 20251224092824.png]]
# （五）实验结果总结
## 一、选择一个TCP帧，观察其协议层：
#### 1、根据你的理解，绘制TCP报文段的结构图（包括头部各字段的位置及大小）。
以No.974为例：
![[Pasted image 20251231080751.png]]
![[Pasted image 20251231083319.png]]
## 二、在你捕获到的结果中，找到设置了SYN标志的TCP段及其后的数据包，完成以下问题： 
以No.1和No.2为例：
【No.1】
![[屏幕截图 2025-12-31 083656.png]]
![[Pasted image 20251231083525.png]]
![[Pasted image 20251231083604.png]]
【No.2】
![[Pasted image 20251231084013.png]]
![[Pasted image 20251231084040.png]]
#### 1、 绘制三次握手的时序图，直到并包括建立连接后计算机发送的第一个数据包（HTTP GET请求），包括
每个数据段的序列号和Ack标号；
本地计算机发送或接收每个数据段的时间（以毫秒为单位）；
本地计算机从发送SYN段到接收到SYN-ACK段的往返时间；
![[Pasted image 20251231090446.png]]
#### 2、SYN数据包上携带哪些TCP 选项？
同样以No.1为例：
![[Pasted image 20251231083525.png]]
![[Pasted image 20251231083604.png]]
Options:(12bytes)
- 【最大段长】TCP Option-Maximum Segment Size:1460bytes 
- 【NOP】TCP Option-No-Operation
- 【窗口尺度】TCP Option-Window scale:8
- 【NOP】TCP Option-No-Operation
- 【NOP】TCP Option-No-Operation
- 【选择确认】TCP Option-SACK Permitted(4)
#### 3、传输完成后，TCP连接会以四次挥手或一端发送RST数据包的方式断开，同1一样，绘制TCP连接释放的时序图（从发出第一个FIN或RST到连接断开为止）。
![[Pasted image 20251231090103.png]]
![[Pasted image 20251231143057.png]]
## 三、在“统计”菜单下，选择“TCP流图形”，选择“窗口尺寸”，以查看数据包速率。
下载：
![[window.png]]
上传：
![[上传.png]]
#### 通过你对数据传输的理解，回答以下问题：
#### 1、实验中下载的大概速率为多少？（以packets/s和bits/s为单位）
取以下一段用于计算：
![[屏幕截图 2025-12-31 092602.png]]
左上角坐标：`点击选取分组 18（0.8369s len 653 seq 6131 ack 692 win 31872）→15 分组，7460 bytes⬅13 分组，999bytes`
![[屏幕截图 2025-12-31 092615.png]]
右下角坐标：`点击选取分组 21（0.9228s len 653 seq 6131 ack 692 win 31872）→15 分组，7460 bytes⬅13 分组，999bytes`
##### ①以packets/s为单位：
$n=15$
$\Delta t=0.9228-0.8369=0.0859s$
$v=\frac{15}{0.0859}\approx 174.62 \quad packets/s$
##### ②以bits/s为单位：
$\Delta t=0.9228-0.8369=0.0859s$
$\Delta Bytes=7460 bytes=59680bits$
$v=\frac{59680}{0.0859}=694761.35 \quad bits/s$

#### 2、下载内容（即TCP有效负载）占下载率的百分比是多少？
$MSS=1460\quad bytes$
$IP Header=TCP Header=20bytes$
$\frac{1460}{1460+20+20}\approx 0.973=97.3\%$

#### 3、实验中上传的大概速率为多少？（以packets/s和bits/s为单位）
![[屏幕截图 2025-12-31 134357.png]]
左上角坐标：`点击选取分组4（0.08874s len 407 seq 1 ack 1 win 65280）→13分组，99bytes⬅15分组，7460bytes`
![[屏幕截图 2025-12-31 134411.png]]
右下角坐标：`点击选取分组8（0.1804s len 0 seq 408 ack 2529 win 65280）→13分组，99bytes⬅15分组，7460bytes`
##### ①以packets/s为单位：
$n=13$
$\Delta t=0.08874s$
$v=\frac{13}{0.08874}\approx 146.50 \quad packets/s$
##### ②以bits/s为单位：
$\Delta t=0.08874s$
$\Delta Bytes=999 bytes=7992bits$
$v=\frac{7992}{0.08874}\approx 90060.85 \quad bits/s$

#### 4、如果最近从服务器收到的TCP数据段的序列号是X，那么下一个发送TCP报文中的Ack号是多少？
以No.21和No.22为例：
![[Pasted image 20251231135649.png]]
No.21：
序列号X=6131
Len=653
No.22：
Ack号=6784=6131+653
$\therefore 下一个发送TCP报文中的Ack号=上一个包TCP数据段的序列号X+其TCP有效负载长度$
## 四、在完成本实验后继续探索TCP协议：

#### 1.探索TCP的拥塞控制和经典AIMD策略。
AIMD策略是实现TCP拥塞控制的一种算法，主要通过对拥塞窗口cwnd的操控来实现，cwnd的变化阶段分为慢启动、拥塞避免、快速重传和快速恢复
- 当TCP检测到没有丢包时，每个RTT将ccwnd增加一个MSS $cwnd=cwnd+1$
- 当TCP检测到丢包时，会立即将cwnd减半 $cwnd=cwnd/2$
#### 2.更深入地探索TCP的可靠性机制。捕获包括段丢失的TCP连接，查看什么触发重新传输以及何时触发，另外查看往返时间估算工具。
当定时器超时但仍未收到ack时，会触发超时重传；当收到3个重复的ack时，会触发快速重传。可以通过wireshark的"统计"-"TCP流图形"-"往返时间"来获取RTT的变化。
![[Pasted image 20251231141304.png]]
#### 3.查看包括SACK在内的选项的使用以了解详细信息。
以No.1为例：
![[屏幕截图 2025-12-31 142236.png]]
设置为`SACK permitted`，表示支持SACK机制
#### 4.TCP是Web的基础传输层。可以通过设置并发连接来查看浏览器如何使用TCP。
在wireshark中通过"统计"-"会话"查看浏览器与Web服务器之间的并发行为
![[屏幕截图 2025-12-31 142609.png]]
在访问目的IP=`160.16.86.14` 的服务器时，Flow=6，表示浏览器为了优化HTTP/1.1性能开启了6个并行的TCP会话
# （六）附录
无

